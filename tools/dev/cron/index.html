<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cron 表达式解析器</title>
    <link href="https://unpkg.com/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../../asset/common.css">
    <link rel="stylesheet" href="https://unpkg.com/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        .cron-segment {
            background-color: #f8f9fa;
            border-radius: 0.375rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .execution-time {
            background-color: #e9f7ef;
            border-left: 4px solid #28a745;
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <div id="navbar-container"></div>
    
    <div class="container container-main">
        <!-- 面包屑导航 -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">开发工具</li>
                <li class="breadcrumb-item active" aria-current="page">Cron 表达式解析器</li>
            </ol>
        </nav>
        
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Cron 表达式解析器</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="cronExpression" class="form-label">Cron 表达式</label>
                    <input type="text" class="form-control font-monospace" id="cronExpression" placeholder="例如: 0 0 * * * 或 0 0 1 * * 或 0 0 1 1 *" value="0 0 * * *">
                    <div class="form-text">
                        格式: 分 时 日 月 周 (例如: 0 0 * * * 表示每天午夜执行)
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="startDate" class="form-label">起始日期</label>
                        <input type="date" class="form-control" id="startDate">
                    </div>
                    <div class="col-md-6">
                        <label for="endDate" class="form-label">结束日期</label>
                        <input type="date" class="form-control" id="endDate">
                    </div>
                </div>
                
                <div class="d-flex justify-content-between mb-3">
                    <div>
                        <button id="parseBtn" class="btn btn-primary me-2">
                            <i class="bi bi-search me-1"></i>
                            解析表达式
                        </button>
                        <button id="clearBtn" class="btn btn-danger">
                            <i class="bi bi-trash me-1"></i>
                            清空
                        </button>
                    </div>
                </div>
                
                <div id="resultsSection" style="display: none;">
                    <div class="cron-segment">
                        <h6>表达式解析</h6>
                        <div class="row">
                            <div class="col-md-2">
                                <strong>分钟:</strong>
                                <div id="minuteDetail"></div>
                            </div>
                            <div class="col-md-2">
                                <strong>小时:</strong>
                                <div id="hourDetail"></div>
                            </div>
                            <div class="col-md-2">
                                <strong>日期:</strong>
                                <div id="dayDetail"></div>
                            </div>
                            <div class="col-md-3">
                                <strong>月份:</strong>
                                <div id="monthDetail"></div>
                            </div>
                            <div class="col-md-3">
                                <strong>星期:</strong>
                                <div id="weekdayDetail"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card mt-3">
                        <div class="card-header">
                            <h6 class="mb-0">最近执行时间</h6>
                        </div>
                        <div class="card-body">
                            <div id="executionTimes"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 百科内容 -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">关于 Cron 表达式</h5>
            </div>
            <div class="card-body">
                <h6>什么是 Cron 表达式</h6>
                <p>
                    Cron 表达式是一个字符串，用于配置任务的执行时间。它由五个或六个字段组成（本工具使用五字段格式），
                    分别表示分钟、小时、日期、月份和星期几。通过 Cron 表达式可以精确地定义任务的执行计划。
                </p>
                
                <h6>Cron 表达式格式</h6>
                <p>
                    标准格式为：<code>分 时 日 月 周</code>
                </p>
                <ul>
                    <li><strong>分：</strong>0-59</li>
                    <li><strong>时：</strong>0-23</li>
                    <li><strong>日：</strong>1-31</li>
                    <li><strong>月：</strong>1-12 或 JAN-DEC</li>
                    <li><strong>周：</strong>0-7（0 和 7 都表示星期日）或 SUN-SAT</li>
                </ul>
                
                <h6>特殊字符</h6>
                <ul>
                    <li><strong>*：</strong>匹配该字段的所有值</li>
                    <li><strong>?：</strong>不指定值，用于日和周字段的互斥</li>
                    <li><strong>-：</strong>表示范围，如 1-5 表示 1 到 5</li>
                    <li><strong>,：</strong>表示列举，如 1,3,5 表示 1、3、5</li>
                    <li><strong>/：</strong>表示步长，如 0/15 表示从 0 开始每 15 分钟</li>
                    <li><strong>L：</strong>表示最后，如 L 在日字段表示当月最后一天</li>
                    <li><strong>W：</strong>表示工作日，如 15W 表示离 15 号最近的工作日</li>
                    <li><strong>#：</strong>表示第几个星期几，如 6#3 表示第三个星期五</li>
                </ul>
                
                <h6>常用示例</h6>
                <ul>
                    <li><strong>0 0 * * *：</strong>每天午夜执行</li>
                    <li><strong>0 0 1 * *：</strong>每月 1 日午夜执行</li>
                    <li><strong>0 0 1 1 *：</strong>每年 1 月 1 日午夜执行</li>
                    <li><strong>0 0 * * 0：</strong>每周日午夜执行</li>
                    <li><strong>0 */2 * * *：</strong>每隔 2 小时执行</li>
                    <li><strong>0 9-17 * * *：</strong>每天上午 9 点到下午 5 点每小时执行</li>
                </ul>
                
                <h6>如何使用本工具</h6>
                <ol>
                    <li>在输入框中输入 Cron 表达式</li>
                    <li>设置起始和结束日期</li>
                    <li>点击"解析表达式"按钮</li>
                    <li>查看表达式解析结果和最近执行时间</li>
                </ol>
                
                <h6>注意事项</h6>
                <ul>
                    <li>工具完全在浏览器中运行，不会上传任何数据</li>
                    <li>本工具仅支持标准的五字段 Cron 表达式</li>
                    <li>执行时间计算基于本地时区</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div id="footer-container"></div>

    <script src="https://unpkg.com/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../asset/navbar.js"></script>
    <script src="../../asset/footer.js"></script>
    <script src="../../asset/common.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const cronExpression = document.getElementById('cronExpression');
            const startDate = document.getElementById('startDate');
            const endDate = document.getElementById('endDate');
            const resultsSection = document.getElementById('resultsSection');
            
            // 设置默认日期范围（最近一周）
            const now = new Date();
            const oneWeekLater = new Date();
            oneWeekLater.setDate(now.getDate() + 7);
            
            startDate.valueAsDate = now;
            endDate.valueAsDate = oneWeekLater;
            
            // 解析 Cron 表达式
            document.getElementById('parseBtn').addEventListener('click', function() {
                try {
                    const expression = cronExpression.value.trim();
                    const start = new Date(startDate.value);
                    const end = new Date(endDate.value);
                    
                    if (!expression) {
                        showToast('请输入 Cron 表达式', 'error');
                        return;
                    }
                    
                    if (isNaN(start.getTime()) || isNaN(end.getTime())) {
                        showToast('请选择有效的起始和结束日期', 'error');
                        return;
                    }
                    
                    if (start >= end) {
                        showToast('结束日期必须晚于起始日期', 'error');
                        return;
                    }
                    
                    // 解析 Cron 表达式
                    const parts = expression.split(' ');
                    if (parts.length !== 5) {
                        showToast('Cron 表达式必须包含 5 个字段', 'error');
                        return;
                    }
                    
                    // 显示解析结果
                    displayCronDetails(parts);
                    
                    // 计算执行时间
                    calculateExecutionTimes(expression, start, end);
                    
                    // 显示结果区域
                    resultsSection.style.display = 'block';
                    
                    // 滚动到结果区域
                    resultsSection.scrollIntoView({ behavior: 'smooth' });
                } catch (e) {
                    showToast('解析出错: ' + e.message, 'error');
                }
            });
            
            // 清空功能
            document.getElementById('clearBtn').addEventListener('click', function() {
                cronExpression.value = '0 0 * * *';
                const now = new Date();
                const oneWeekLater = new Date();
                oneWeekLater.setDate(now.getDate() + 7);
                startDate.valueAsDate = now;
                endDate.valueAsDate = oneWeekLater;
                resultsSection.style.display = 'none';
            });
            
            // 显示 Cron 表达式详情
            function displayCronDetails(parts) {
                document.getElementById('minuteDetail').textContent = parts[0];
                document.getElementById('hourDetail').textContent = parts[1];
                document.getElementById('dayDetail').textContent = parts[2];
                document.getElementById('monthDetail').textContent = parts[3];
                document.getElementById('weekdayDetail').textContent = parts[4];
            }
            
            // 计算执行时间
            function calculateExecutionTimes(expression, start, end) {
                const executionTimes = document.getElementById('executionTimes');
                executionTimes.innerHTML = '<p class="text-muted">正在计算执行时间...</p>';
                
                // 模拟计算过程（实际应用中这里会有复杂的时间计算逻辑）
                setTimeout(() => {
                    try {
                        // 这里只是一个简化的示例，实际的 Cron 解析会更复杂
                        const times = generateSampleExecutionTimes(expression, start, end);
                        
                        if (times.length === 0) {
                            executionTimes.innerHTML = '<p class="text-muted">在此时间段内没有计划的执行时间</p>';
                            return;
                        }
                        
                        let html = '<div class="row">';
                        times.forEach((time, index) => {
                            if (index < 20) { // 限制显示前20个
                                html += `
                                    <div class="col-md-3 mb-2">
                                        <div class="execution-time p-2">
                                            ${time}
                                        </div>
                                    </div>
                                `;
                            }
                        });
                        html += '</div>';
                        
                        if (times.length > 20) {
                            html += `<p class="text-muted mt-2">共找到 ${times.length} 个执行时间，仅显示前 20 个。</p>`;
                        }
                        
                        executionTimes.innerHTML = html;
                    } catch (e) {
                        executionTimes.innerHTML = `<p class="text-danger">计算执行时间时出错: ${e.message}</p>`;
                    }
                }, 500);
            }
            
            // 生成示例执行时间（实际应用中应该有完整的 Cron 解析逻辑）
            function generateSampleExecutionTimes(expression, start, end) {
                const times = [];
                const current = new Date(start);
                
                // 简化的逻辑，仅用于演示
                while (current <= end) {
                    // 每天添加一个示例时间
                    const timeStr = current.toLocaleString('zh-CN');
                    times.push(timeStr);
                    current.setDate(current.getDate() + 1);
                }
                
                return times;
            }
        });
    </script>
</body>
</html>