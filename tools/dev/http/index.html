<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTTP 请求模拟器</title>
    <link href="https://unpkg.com/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../../asset/common.css">
    <link rel="stylesheet" href="https://unpkg.com/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        .request-section {
            background-color: #f8f9fa;
            border-radius: 0.375rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .response-header {
            background-color: #e9f7ef;
            border-left: 4px solid #28a745;
            padding: 0.5rem;
            margin-bottom: 1rem;
        }
        .response-content {
            background-color: #f8f9fa;
            border-radius: 0.375rem;
            padding: 1rem;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 400px;
            overflow-y: auto;
        }
        .status-success {
            color: #28a745;
        }
        .status-error {
            color: #dc3545;
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <div id="navbar-container"></div>
    
    <div class="container container-main">
        <!-- 面包屑导航 -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">开发工具</li>
                <li class="breadcrumb-item active" aria-current="page">HTTP 请求模拟器</li>
            </ol>
        </nav>
        
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">HTTP 请求模拟器</h5>
            </div>
            <div class="card-body">
                <div class="request-section">
                    <div class="row mb-3">
                        <div class="col-md-2">
                            <label for="method" class="form-label">方法</label>
                            <select class="form-select" id="method">
                                <option value="GET" selected>GET</option>
                                <option value="POST">POST</option>
                                <option value="PUT">PUT</option>
                                <option value="DELETE">DELETE</option>
                                <option value="PATCH">PATCH</option>
                                <option value="HEAD">HEAD</option>
                                <option value="OPTIONS">OPTIONS</option>
                            </select>
                        </div>
                        <div class="col-md-10">
                            <label for="url" class="form-label">URL</label>
                            <input type="text" class="form-control" id="url" placeholder="例如: https://httpbin.org/get">
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <label for="headers" class="form-label">请求头 (每行一个，格式: Key: Value)</label>
                            <textarea class="form-control font-monospace" id="headers" rows="3" placeholder="User-Agent: Mozilla/5.0&#10;Accept: application/json"></textarea>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <label for="body" class="form-label">请求体</label>
                            <textarea class="form-control font-monospace" id="body" rows="5" placeholder="请求体内容 (适用于 POST, PUT, PATCH 等方法)"></textarea>
                        </div>
                    </div>
                </div>
                
                <div class="d-flex justify-content-between mb-3">
                    <div>
                        <button id="sendBtn" class="btn btn-primary me-2">
                            <i class="bi bi-send me-1"></i>
                            发送请求
                        </button>
                        <button id="clearBtn" class="btn btn-danger">
                            <i class="bi bi-trash me-1"></i>
                            清空
                        </button>
                    </div>
                </div>
                
                <div id="resultsSection" style="display: none;">
                    <div class="response-header">
                        <h6 class="mb-0">响应信息</h6>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-3">
                            <strong>状态码:</strong>
                            <span id="statusCode"></span>
                        </div>
                        <div class="col-md-3">
                            <strong>状态文本:</strong>
                            <span id="statusText"></span>
                        </div>
                        <div class="col-md-3">
                            <strong>耗时:</strong>
                            <span id="duration"></span> ms
                        </div>
                        <div class="col-md-3">
                            <strong>大小:</strong>
                            <span id="size"></span> bytes
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <ul class="nav nav-tabs" id="responseTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="body-tab" data-bs-toggle="tab" data-bs-target="#responseBody" type="button" role="tab">响应体</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="headers-tab" data-bs-toggle="tab" data-bs-target="#responseHeaders" type="button" role="tab">响应头</button>
                                </li>
                            </ul>
                            <div class="tab-content" id="responseTabsContent">
                                <div class="tab-pane fade show active" id="responseBody" role="tabpanel">
                                    <div class="response-content mt-3" id="responseBodyContent"></div>
                                </div>
                                <div class="tab-pane fade" id="responseHeaders" role="tabpanel">
                                    <div class="response-content mt-3" id="responseHeadersContent"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 百科内容 -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">关于 HTTP 请求</h5>
            </div>
            <div class="card-body">
                <h6>什么是 HTTP 请求</h6>
                <p>
                    HTTP（HyperText Transfer Protocol）是一种用于分布式、协作式和超媒体信息系统的应用层协议。
                    HTTP 请求是客户端向服务器发送的请求消息，用于获取或操作资源。
                </p>
                
                <h6>HTTP 方法</h6>
                <ul>
                    <li><strong>GET：</strong>请求指定的资源，通常用于获取数据</li>
                    <li><strong>POST：</strong>向指定资源提交数据进行处理请求（例如提交表单或者上传文件）</li>
                    <li><strong>PUT：</strong>向指定资源位置上传其最新内容</li>
                    <li><strong>DELETE：</strong>请求服务器删除指定的资源</li>
                    <li><strong>PATCH：</strong>对资源进行部分修改</li>
                    <li><strong>HEAD：</strong>向服务器索要与 GET 请求相一致的响应，只不过响应体不会被返回</li>
                    <li><strong>OPTIONS：</strong>返回服务器针对特定资源所支持的通信选项</li>
                </ul>
                
                <h6>HTTP 请求结构</h6>
                <ul>
                    <li><strong>请求行：</strong>包含方法、URL 和 HTTP 版本</li>
                    <li><strong>请求头：</strong>包含关于请求的附加信息，如 User-Agent、Accept 等</li>
                    <li><strong>空行：</strong>分隔请求头和请求体</li>
                    <li><strong>请求体：</strong>包含要发送给服务器的数据</li>
                </ul>
                
                <h6>常见用途</h6>
                <ul>
                    <li>API 测试和调试</li>
                    <li>前后端联调</li>
                    <li>网络请求分析</li>
                    <li>学习 HTTP 协议</li>
                </ul>
                
                <h6>如何使用本工具</h6>
                <ol>
                    <li>选择 HTTP 方法</li>
                    <li>输入请求 URL</li>
                    <li>根据需要添加请求头</li>
                    <li>对于 POST/PUT 等方法，可以添加请求体</li>
                    <li>点击"发送请求"按钮</li>
                    <li>查看响应信息，包括状态码、响应头和响应体</li>
                </ol>
                
                <h6>注意事项</h6>
                <ul>
                    <li>工具完全在浏览器中运行，受同源策略限制</li>
                    <li>某些请求可能因 CORS 限制而失败</li>
                    <li>请确保请求的 URL 是安全可靠的</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div id="footer-container"></div>

    <script src="https://unpkg.com/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../asset/navbar.js"></script>
    <script src="../../asset/footer.js"></script>
    <script src="../../asset/common.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const method = document.getElementById('method');
            const url = document.getElementById('url');
            const headers = document.getElementById('headers');
            const body = document.getElementById('body');
            const resultsSection = document.getElementById('resultsSection');
            
            // 发送请求
            document.getElementById('sendBtn').addEventListener('click', function() {
                try {
                    const methodValue = method.value;
                    const urlValue = url.value.trim();
                    
                    if (!urlValue) {
                        showToast('请输入请求 URL', 'error');
                        return;
                    }
                    
                    // 解析请求头
                    const headersObj = {};
                    const headersText = headers.value.trim();
                    if (headersText) {
                        const headerLines = headersText.split('\n');
                        for (const line of headerLines) {
                            const colonIndex = line.indexOf(':');
                            if (colonIndex > 0) {
                                const key = line.substring(0, colonIndex).trim();
                                const value = line.substring(colonIndex + 1).trim();
                                headersObj[key] = value;
                            }
                        }
                    }
                    
                    // 发送请求
                    sendHttpRequest(methodValue, urlValue, headersObj, body.value);
                } catch (e) {
                    showToast('发送请求时出错: ' + e.message, 'error');
                }
            });
            
            // 清空功能
            document.getElementById('clearBtn').addEventListener('click', function() {
                method.value = 'GET';
                url.value = '';
                headers.value = '';
                body.value = '';
                resultsSection.style.display = 'none';
            });
            
            // 发送 HTTP 请求
            async function sendHttpRequest(method, url, headers, body) {
                try {
                    // 显示加载状态
                    document.getElementById('sendBtn').disabled = true;
                    document.getElementById('sendBtn').innerHTML = '<span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span> 发送中...';
                    
                    const startTime = Date.now();
                    
                    // 创建请求配置
                    const config = {
                        method: method,
                        headers: headers
                    };
                    
                    // 如果有请求体且方法不是 GET/HEAD，则添加请求体
                    if (body && method !== 'GET' && method !== 'HEAD') {
                        // 如果 Content-Type 是 JSON，则自动处理
                        if (headers['Content-Type'] && headers['Content-Type'].includes('application/json')) {
                            try {
                                config.body = JSON.stringify(JSON.parse(body));
                            } catch (e) {
                                config.body = body;
                            }
                        } else {
                            config.body = body;
                        }
                    }
                    
                    // 发送请求
                    const response = await fetch(url, config);
                    const endTime = Date.now();
                    const duration = endTime - startTime;
                    
                    // 获取响应信息
                    const statusCode = response.status;
                    const statusText = response.statusText;
                    const responseHeaders = [...response.headers.entries()].map(([key, value]) => `${key}: ${value}`).join('\n');
                    const responseBody = await response.text();
                    const size = new Blob([responseBody]).size;
                    
                    // 显示结果
                    displayResponse(statusCode, statusText, duration, size, responseBody, responseHeaders);
                    
                    // 滚动到结果区域
                    resultsSection.scrollIntoView({ behavior: 'smooth' });
                } catch (e) {
                    showToast('请求失败: ' + e.message, 'error');
                } finally {
                    // 恢复按钮状态
                    document.getElementById('sendBtn').disabled = false;
                    document.getElementById('sendBtn').innerHTML = '<i class="bi bi-send me-1"></i> 发送请求';
                }
            }
            
            // 显示响应结果
            function displayResponse(statusCode, statusText, duration, size, body, headers) {
                // 设置状态码样式
                const statusCodeElement = document.getElementById('statusCode');
                statusCodeElement.textContent = statusCode;
                statusCodeElement.className = statusCode >= 200 && statusCode < 300 ? 'status-success' : 'status-error';
                
                document.getElementById('statusText').textContent = statusText;
                document.getElementById('duration').textContent = duration;
                document.getElementById('size').textContent = size;
                document.getElementById('responseBodyContent').textContent = body;
                document.getElementById('responseHeadersContent').textContent = headers;
                
                // 显示结果区域
                resultsSection.style.display = 'block';
            }
        });
    </script>
</body>
</html>